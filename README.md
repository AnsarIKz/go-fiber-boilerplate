# NODA Backend - SMS Authentication System

–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π:

- **–ó–∞—è–≤–∫–∏ –≤–º–µ—Å—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–∞—é—Ç –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- **–ê–¥–º–∏–Ω—Å–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ** - –∑–∞—è–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏ –æ–¥–æ–±—Ä—è—é—Ç—Å—è/–æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è –∞–¥–º–∏–Ω–æ–º
- **SMS-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ SMS-–∫–æ–¥ –±–µ–∑ –ø–∞—Ä–æ–ª—è

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
internal/
‚îú‚îÄ‚îÄ applications/          # üíé –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
‚îÇ   ‚îú‚îÄ‚îÄ submit.go          # –õ–æ–≥–∏–∫–∞ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ approve.go         # –õ–æ–≥–∏–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∞)
‚îÇ   ‚îú‚îÄ‚îÄ reject.go          # –õ–æ–≥–∏–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ (–¥–ª—è –∞–¥–º–∏–Ω–∞)
‚îÇ   ‚îî‚îÄ‚îÄ routes.go          # –†–æ—É—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ auth/                  # üíé –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ request_code.go    # –®–∞–≥ 1: –ó–∞–ø—Ä–æ—Å –°–ú–°-–∫–æ–¥–∞ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ verify_code.go     # –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –∏ –≤—ã–¥–∞—á–∞ JWT
‚îÇ   ‚îú‚îÄ‚îÄ middleware.go      # Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–æ—É—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ routes.go
‚îÇ
‚îú‚îÄ‚îÄ users/                 # üíé –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ user.go            # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Phone, Status)
‚îÇ   ‚îî‚îÄ‚îÄ repository.go      # –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
‚îÇ

pkg/
‚îú‚îÄ‚îÄ jwthelper/jwthelper.go # JWT —Ç–æ–∫–µ–Ω—ã
‚îú‚îÄ‚îÄ otp/                   # üçÄ One-Time Password
‚îÇ   ‚îî‚îÄ‚îÄ otp.go             # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –≤ Redis
‚îî‚îÄ‚îÄ sms/                   # üçÄ SMS Service
    ‚îî‚îÄ‚îÄ client.go          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –°–ú–°
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
DB_HOST=localhost
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=nodabackend
DB_PORT=5432

# JWT —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis –¥–ª—è OTP –∫–æ–¥–æ–≤
REDIS_URL=localhost:6379

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
SMS_PROVIDER=mock # mock, twilio
TWILIO_ACCOUNT_SID=your-twilio-account-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_FROM_NUMBER=+1234567890

# –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞
PORT=3000

# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
ADMIN_PHONE=+1234567890
ADMIN_NAME=System Administrator
```

### 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
go mod tidy

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∏ Redis –∑–∞–ø—É—â–µ–Ω—ã
# –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker Compose:
docker-compose up -d
```

### 3. –ó–∞–ø—É—Å–∫

```bash
go run cmd/api/main.go
```

## API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ —Ä–æ—É—Ç—ã

#### –ü–æ–¥–∞—á–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é

```http
POST /api/v1/applications/submit
Content-Type: application/json

{
  "phone": "+1234567890",
  "name": "John Doe"
}
```

#### –ó–∞–ø—Ä–æ—Å SMS-–∫–æ–¥–∞ –¥–ª—è –≤—Ö–æ–¥–∞

```http
POST /api/v1/auth/request-code
Content-Type: application/json

{
  "phone": "+1234567890"
}
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ SMS-–∫–æ–¥–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT

```http
POST /api/v1/auth/verify-code
Content-Type: application/json

{
  "phone": "+1234567890",
  "code": "123456"
}
```

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Ä–æ—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç JWT)

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```http
GET /api/v1/protected/profile
Authorization: Bearer <jwt-token>
```

### –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ä–æ—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç JWT + admin –ø—Ä–∞–≤–∞)

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏

```http
GET /api/v1/applications/admin/pending?limit=20&offset=0
Authorization: Bearer <admin-jwt-token>
```

#### –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏

```http
POST /api/v1/applications/admin/approve
Authorization: Bearer <admin-jwt-token>
Content-Type: application/json

{
  "user_id": 1
}
```

#### –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏

```http
POST /api/v1/applications/admin/reject
Authorization: Bearer <admin-jwt-token>
Content-Type: application/json

{
  "user_id": 1,
  "reason": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö"
}
```

## –°—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- `pending` - –ó–∞—è–≤–∫–∞ –ø–æ–¥–∞–Ω–∞, –æ–∂–∏–¥–∞–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
- `approved` - –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è
- `rejected` - –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞
- `blocked` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (Go Best Practices)

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Clean Architecture**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ domain/usecase/repository —Å–ª–æ–∏
- **Dependency Injection**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤ usecase, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ repository
- **Factory Pattern**: –§—É–Ω–∫—Ü–∏–∏ `New...()` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### üîß –ü–æ—Ä–æ–∂–¥–∞—é—â–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Functional Options**: –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`WithTimeout`, `WithMaxConn`)
- **Builder Pattern**: –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### üèõÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Decorator**: HTTP middleware (auth, logging, metrics)
- **Interface Segregation**: –ú–µ–ª–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤–º–µ—Å—Ç–æ –±–æ–ª—å—à–∏—Ö

### ‚ö° –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

- **Worker Pool**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- **Fan-out/Fan-in**: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Å–±–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **Context**: –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

### üìã –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

- **Error Handling**: –Ø–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, sentinel errors
- **Graceful Shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [docs/README.md](./docs/README.md)

### –ö–æ–Ω–≤–µ–Ω—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞

- [üìù –ü—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è](./docs/NAMING_CONVENTIONS.md)
- [üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](./docs/PROJECT_STRUCTURE.md)
- [üöÄ –ö–æ–º–º–∏—Ç—ã](./docs/COMMIT_CONVENTIONS.md)

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å OTP**: –ö–æ–¥—ã –¥–µ–π—Å—Ç–≤—É—é—Ç 5 –º–∏–Ω—É—Ç, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
2. **SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∑–∞—è–≤–∫–∏
3. **–ê–¥–º–∏–Ω—Å–∫–∞—è –ø–∞–Ω–µ–ª—å**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
4. **JWT —Ç–æ–∫–µ–Ω—ã**: 24 —á–∞—Å–∞ –∂–∏–∑–Ω–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
5. **–ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏–∏**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `users`

- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `phone` - –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `name` - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `status` - –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `is_admin` - –§–ª–∞–≥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `created_at`, `updated_at`, `deleted_at` - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
